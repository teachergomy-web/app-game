<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ³¨éŸ³å¥½å¥½ç©ã„…ã„†ã„‡</title>
    
    <!-- 1. Tailwind CSS æ¡†æ¶ -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. React & ReactDOM å‡½å¼åº« -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- 3. Babel ç·¨è­¯å™¨ (ç”¨æ–¼ JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 4. å°ˆç”¨å­—é«” (Zen Maru Gothic) -->
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700;900&display=swap" rel="stylesheet">

    <style>
        /* åŸºç¤æ¨£å¼å’ŒèƒŒæ™¯ */
        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background-color: #E3F2FD; 
            /* æ·ºè—è‰²åœ“é»èƒŒæ™¯ */
            background-image: radial-gradient(#90CAF9 2px, transparent 2px);
            background-size: 30px 30px;
            user-select: none; /* é˜²æ­¢é¸å– */
            overflow-x: hidden; /* é˜²æ­¢æ°´å¹³æ»¾å‹• */
            -webkit-tap-highlight-color: transparent; /* ç§»é™¤ç§»å‹•ç«¯é»æ“Šé«˜äº® */
        }
        
        /* éš±è—æ•¸å­—è¼¸å…¥æ¡†çš„ç®­é ­ */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none;
            margin: 0; 
        }

        /* 3D ç¿»è½‰æ•ˆæœçš„ CSS è¨­å®š */
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        
        /* å½ˆè·³é€²å…¥å‹•ç•« */
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); opacity: 1; }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }
        .animate-bounce-in {
            animation: bounceIn 0.5s cubic-bezier(0.215, 0.610, 0.355, 1.000) both;
        }

        /* å°ˆç‚ºæ™‚é–“åˆ°å½ˆçª—è¨­è¨ˆçš„å‹•ç•« */
        @keyframes ping-once {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-ping-once {
            animation: ping-once 0.8s ease-out;
        }

        /* è‡ªå®šç¾©æ»¾å‹•æ¢ (éš±è—ä½†åœ¨å¯æ»¾å‹•å€åŸŸä¿ç•™åŠŸèƒ½) */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // å–å¾— React æ ¸å¿ƒ Hook
        const { useState, useEffect, useCallback, useRef } = React;

        // ============================================================================
        // 0. å…§åµŒ SVG åœ–ç¤ºå…ƒä»¶
        // ============================================================================
        const SVGIcon = ({ d, stroke = "currentColor", fill = "none", className = "w-5 h-5", size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" className={className} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" stroke={stroke} fill={fill}>
                <path d={d} />
            </svg>
        );
        const ZapIcon = (props) => (
            <SVGIcon {...props} d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" />
        );
        const MessageCircleIcon = (props) => (
            <SVGIcon {...props} d="M7.9 20A9 9 0 0 0 16 15V4a2 2 0 0 0-2-2C10.5 2 7 5.5 7 10v2" />
        );
        const UsersIcon = (props) => (
            <SVGIcon {...props} d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2m18 0v-2a4 4 0 0 0-4-4M10 4a4 4 0 1 0 0 8 4 4 0 0 0 0-8zM17 11h1v1" />
        );
        const ClockIcon = (props) => (
            <SVGIcon {...props} d="M12 2v2M22 12h-2M12 22v-2M4 12H2M12 12L15 9M12 12V4" />
        );
        const LightbulbIcon = (props) => (
            <SVGIcon {...props} d="M15 14c.2-.3.4-.6.6-.9.2-.3.4-.6.6-1V7c0-2.8-2.2-5-5-5S7 4.2 7 7v5.1c.2.3.4.6.6.9.2.3.4.6.6 1M12 22a2 2 0 0 0 2-2H10a2 2 0 0 0 2 2zM12 18a4 4 0 0 1-4-4" />
        );
        const BookOpenIcon = (props) => (
            <SVGIcon {...props} d="M2 3h6a4 4 0 0 1 4 4v14H4a2 2 0 0 1-2-2zm20 0h-6a4 4 0 0 0-4 4v14h12a2 2 0 0 0-2-2z" />
        );
        const SettingsIcon = (props) => (
             <SVGIcon {...props} d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.18-.08a2 2 0 0 0-2 0l-.45.45a2 2 0 0 0 0 2l.08.18a2 2 0 0 1 0 2l-.25.43a2 2 0 0 1-1.73 1H2a2 2 0 0 0-2 2v.44a2 2 0 0 0 2 2h.18a2 2 0 0 1 1.73 1l.25.43a2 2 0 0 1 0 2l-.08.18a2 2 0 0 0 0 2l.45.45a2 2 0 0 0 2 0l.18-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V22a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.18.08a2 2 0 0 0 2 0l.45-.45a2 2 0 0 0 0-2l-.08-.18a2 2 0 0 1 0-2l.25-.43a2 2 0 0 1 1.73-1H22a2 2 0 0 0 2-2v-.44a2 2 0 0 0-2-2h-.18a2 2 0 0 1-1.73-1l-.25-.43a2 2 0 0 1 0-2l.08-.18a2 2 0 0 0 0-2l-.45-.45a2 2 0 0 0-2 0l-.18.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" />
        );

        // ============================================================================
        // 1. éŸ³æ•ˆå·¥å…·
        // ============================================================================
        const useBeep = () => {
            const audioCtxRef = useRef(null);

            const getAudioContext = useCallback(() => {
                if (!audioCtxRef.current) {
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    if (AudioContext) {
                        audioCtxRef.current = new AudioContext();
                    }
                }
                if (audioCtxRef.current && audioCtxRef.current.state === 'suspended') {
                    audioCtxRef.current.resume().catch(e => console.error("Audio resume failed", e));
                }
                return audioCtxRef.current;
            }, []);

            const playBeep = useCallback((freq = 440, duration = 0.1, type = 'sine', volume = 0.1) => {
                try {
                    const ctx = getAudioContext();
                    if (!ctx) return;

                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.type = type;
                    osc.frequency.setValueAtTime(freq, ctx.currentTime);
                    gain.gain.setValueAtTime(volume, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    osc.start();
                    osc.stop(ctx.currentTime + duration);
                } catch (e) { console.error("éŸ³æ•ˆæ’­æ”¾å¤±æ•—:", e); }
            }, [getAudioContext]);

            const playCountdownBeep = useCallback((secondsLeft) => {
                if (secondsLeft > 10) {
                    playBeep(400, 0.1, 'sine', 0.1); 
                } else if (secondsLeft <= 10 && secondsLeft > 0) {
                    playBeep(600, 0.15, 'square', 0.15);
                }
            }, [playBeep]);
            
            const playTimeUpBeep = useCallback(() => {
                try {
                    const ctx = getAudioContext();
                    if (!ctx) return;
                    
                    const osc1 = ctx.createOscillator();
                    const osc2 = ctx.createOscillator();
                    const gain = ctx.createGain();
                    
                    osc1.type = 'sawtooth';
                    osc2.type = 'sawtooth';
                    osc1.frequency.setValueAtTime(880, ctx.currentTime);
                    osc2.frequency.setValueAtTime(660, ctx.currentTime);
                    
                    gain.gain.setValueAtTime(0.1, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.15, ctx.currentTime + 0.1);
                    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 1.5);
                    
                    osc1.connect(gain);
                    osc2.connect(gain);
                    gain.connect(ctx.destination);
                    
                    osc1.start();
                    osc2.start();
                    osc1.stop(ctx.currentTime + 1.5);
                    osc2.stop(ctx.currentTime + 1.5);
                } catch (e) { console.error("æ™‚é–“åˆ°éŸ³æ•ˆæ’­æ”¾å¤±æ•—:", e); }
            }, [getAudioContext]);

            const playStartBeep = useCallback(() => playBeep(523.25, 0.3, 'sine', 0.15), [playBeep]);
            const playPauseBeep = useCallback(() => playBeep(392, 0.2, 'sine', 0.1), [playBeep]);
            const playResetBeep = useCallback(() => playBeep(330, 0.1, 'sine', 0.05), [playBeep]);

            return { playBeep, playCountdownBeep, playTimeUpBeep, playStartBeep, playPauseBeep, playResetBeep };
        };

        // ============================================================================
        // 2. éŠæˆ²è³‡æ–™åº«
        // ============================================================================
        const GAMES_CONFIG = [
            {
                id: 'game1',
                title: 'æ€¥ä¸­ç”Ÿå­—',
                subtitle: 'ç¿»ç‰Œé™æ™‚é€ è©',
                IconComponent: ZapIcon,
                color: 'bg-orange-500',
                textColor: 'text-orange-600',
                borderColor: 'border-orange-200',
                rule: `è¦å‰‡è§£èªªï¼š\n\n1. ä¾é¡Œç›®é¡åˆ¥ - ç”¨æ³¨éŸ³é–‹é ­é€ è©ã€‚\n(ä¾‹: å‹•ç‰© ï¼ æŠ½åˆ°ã„… ï¼ è±¹ã€åŒ—æ¥µç†Š)\n\n2. æ¯çµ„æ´¾ä¸€äººèµ·ç«‹åŒæ™‚æ¯”è³½ã€‚\n\n3. è¬›å‡ºæ­£ç¢ºç­”æ¡ˆå¯ä»¥å¾—åˆ†ã€‚\n\n4. ä½†è¬›éçš„ç­”æ¡ˆåˆ¥çµ„ä¸èƒ½å†è¬›\n(ä½†åŒéšŠå¯ä»¥å·å·æç¤º)ã€‚`,
                defaultTime: 30,
                rounds: [
                    { category: 'å‹• ç‰©', content: ['ã„', 'ã„ˆ', 'ã„’', 'ã„“', 'ã„¨', 'ã„‹', 'ã„…', 'ã„Œ', 'ã„§', 'ã„', 'ã„©', 'ã„•'] },
                    { category: 'å¯ä»¥åƒçš„æ±è¥¿', content: ['ã„', 'ã„‹', 'ã„¨', 'ã„†', 'ã„‘', 'ã„‡', 'ã„—', 'ã„ˆ', 'ã„…', 'ã„©', 'ã„–', 'ã„•'] },
                    { category: 'å­¸æ ¡è£¡æœƒå‡ºç¾çš„', content: ['ã„™', 'ã„”', 'ã„‡', 'ã„ˆ', 'ã„…', 'ã„', 'ã„†', 'ã„˜', 'ã„Œ', 'ã„’', 'ã„‰', 'ã„•'] },
                    { category: 'æµ´å®¤æœƒçœ‹åˆ°çš„æ±è¥¿', content: ['ã„§', 'ã„', 'ã„‡', 'ã„ˆ', 'ã„©', 'ã„', 'ã„†', 'ã„˜', 'ã„Œ', 'ã„’', 'ã„‰', 'ã„•'] },
                    { category: 'ç™½è‰²çš„æ±è¥¿', content: ['ã„˜', 'ã„', 'ã„•', 'ã„–', 'ã„“', 'ã„’', 'ã„Œ', 'ã„‹', 'ã„‰', 'ã„‡', 'ã„…', 'ã„ˆ'] },
                    { category: 'æœƒè®“çˆ¸åª½ç”Ÿæ°£çš„äº‹', content: ['ã„’', 'ã„Š', 'ã„”', 'ã„', 'ã„‰', 'ã„‡', 'ã„‘', 'ã„†', 'ã„…', 'ã„•', 'ã„Œ', 'ã„'] },
                    { category: 'éœ€è¦æ‰‹å»åšçš„äº‹', content: ['ã„–', 'ã„¨', 'ã„•', 'ã„”', 'ã„“', 'ã„†', 'ã„‰', 'ã„Š', 'ã„‹', 'ã„˜', 'ã„', 'ã„’'] }
                ]
            },
            {
                id: 'game2',
                title: 'èªªå•è§£æ³¨',
                subtitle: 'æ˜¯éé¡ŒçŒœè¬',
                IconComponent: MessageCircleIcon,
                color: 'bg-green-500',
                textColor: 'text-green-600',
                borderColor: 'border-green-200',
                rule: `è¦å‰‡è§£èªªï¼š\n\n1. æ³¨éŸ³æç¤ºçŒœè©ï¼Œé æ˜¯éé¡Œå•ç­”æ¨æ•²è¬åº•ã€‚\n(ä¾‹: ã„†ã„ çŒœä¸€è©)\nQ:æ˜¯èº«é«”éƒ¨ä½å—? A:ä¸æ˜¯\nQ:æ˜¯é£Ÿç‰©å—? A:æ˜¯\n\n2. æ¯çµ„åŒæ™‚ç«¶è³½ï¼Œå¯ä»¥çŒœç­”æ¡ˆæˆ–æ˜¯æå•å•é¡Œã€‚\n\n3. å…ˆè¬›å‡ºæ­£ç¢ºç­”æ¡ˆå¯ä»¥å¾—åˆ†\n(è€å¸«å¯ä»¥çµ¦é©ç•¶æç¤º)ã€‚`,
                defaultTime: 120,
                rounds: [
                    { q: 'ã„Š ã„ˆ', a: 'é ­é«®', hint: 'èº«é«”éƒ¨ä½' }, { q: 'ã„• ã„“', a: 'æ™‚é˜', hint: 'ç‰†ä¸Šçš„ç‰©å“' }, { q: 'ã„§ ã„‰', a: 'å°åº¦', hint: 'åœ‹å®¶åç¨±' }, { q: 'ã„ ã„’', a: 'é«˜é›„', hint: 'å°ç£åœ°å' }, { q: 'ã„ ã„‰', a: 'é›è›‹', hint: 'é£Ÿç‰©' },
                    { q: 'ã„ ã„•', a: 'è€ƒè©¦', hint: 'å­¸æ ¡æ´»å‹•' }, { q: 'ã„ˆ ã„', a: 'é£›æ©Ÿ', hint: 'äº¤é€šå·¥å…·' }, { q: 'ã„Œ ã„', a: 'è¾£æ¤’', hint: 'ä¸€ç¨®èª¿å‘³æ–™' }, { q: 'ã„‡ ã„‘', a: 'éº»é›€', hint: 'ä¸€ç¨®é³¥é¡' }, { q: 'ã„§ ã„•', a: 'ç‰™åˆ·', hint: 'æµ´å®¤ç”¨å“' },
                    { q: 'ã„ ã„”', a: 'è­¦å¯Ÿ', hint: 'ä¸€ç¨®è·æ¥­' }, { q: 'ã„ˆ ã„—', a: 'è‚¥çš‚', hint: 'æ¸…æ½”ç”¨å“' }, { q: 'ã„Œ ã„Š ã„§', a: 'è€å¤©çˆº', hint: 'ç¬¬ä¸€å€‹å­—æ˜¯è€' }, { q: 'ã„– ã„© ã„Š', a: 'æ—¥æœˆæ½­', hint: 'å°ç£æ™¯é»' }, { q: 'ã„‘ ã„ ã„Œ', a: 'å·§å…‹åŠ›', hint: 'ç”œé»' },
                    { q: 'ã„† ã„ ã„‘', a: 'çš®å¡ä¸˜', hint: 'å¡é€šäººç‰©' }, { q: 'ã„’ ã„† ã„˜', a: 'æ©¡çš®æ“¦', hint: 'æ–‡å…·' }, { q: 'ã„’ ã„Š ã„‘', a: 'å°æç´', hint: 'æ¨‚å™¨' }, { q: 'ã„“ ã„“ ã„–', a: 'èœ˜è››äºº', hint: 'è¶…ç´šè‹±é›„' }, { q: 'ã„… ã„ ã„‰', a: 'åŒ—æµ·é“', hint: 'æ—¥æœ¬åœ°å' },
                    { q: 'ã„’ ã„” ã„‘', a: 'å¸å¡µå™¨', hint: 'å®¶é›»' }, { q: 'ã„™ ã„‡ ã„“', a: 'ä¸‰æ˜æ²»', hint: 'æ—©é¤é£Ÿç‰©' }, { q: 'ã„ ã„ ã„”', a: 'æ•‘è­·è»Š', hint: 'è»Šè¼›' }, { q: 'ã„ ã„§ ã„“', a: 'åŠ æ²¹ç«™', hint: 'åœ°é»' }, { q: 'ã„… ã„ ã„‡', a: 'å¯¶å¯å¤¢', hint: 'å¡é€š/éŠæˆ²' },
                    { q: 'ã„’ ã„Œ ã„…', a: 'å°ç± åŒ…', hint: 'é£Ÿç‰©' }, { q: 'ã„š ã„Œ ã„•', a: 'é˜¿é‡Œå±±', hint: 'å°ç£æ™¯é»' }, { q: 'ã„’ ã„¨ ã„—', a: 'å°ä¸¸å­', hint: 'å¡é€šäººç‰©' }, { q: 'ã„ ã„” ã„”', a: 'è¨ˆç¨‹è»Š', hint: 'äº¤é€šå·¥å…·' }, { q: 'ã„™ ã„¨ ã„', a: 'å­«æ‚Ÿç©º', hint: 'ç¥è©±äººç‰©' }
                ]
            },
            {
                id: 'game3',
                title: 'è©æ“…åœ˜é«”',
                subtitle: 'æ³¨éŸ³è¯æƒ³æ¥åŠ›',
                IconComponent: UsersIcon,
                color: 'bg-blue-600',
                textColor: 'text-blue-600',
                borderColor: 'border-blue-200',
                rule: `è¦å‰‡è§£èªªï¼š\n\n1. ç”¨æ³¨éŸ³ç‚ºé¦–é€ è©ã€‚\n(ä¾‹: ã„Šã„ -> æä¾›ã€è½éã€é€éã€é€šéã€æé«˜ã€æ³°åœ‹ã€æ¨å»£)\n\n2. æ¯çµ„åŒæ™‚ç«¶è³½ï¼Œæ¯é¡Œè¨ˆæ™‚3åˆ†é˜ã€‚\n\n3. èˆ‰æ‰‹è¬›æ­£ç¢ºç­”æ¡ˆã€‚\n\n4. å°ä¸€å€‹è¨˜1é»ï¼Œæœ€é«˜åˆ†çµ„ç•¶å±€å‹å‡ºã€‚`,
                defaultTime: 180,
                rounds: [
                    { q: 'ã„… ã„‰', examples: 'å ±åˆ°ã€æ­¥èª¿ã€èƒŒå¸¶ã€å†°å³¶ã€æ¯”å°ã€è®Šå‹•ã€ç­†é›»ã€ä¸å°ã€ä¾¿ç•¶ã€æ“ºå‹•ã€è¡¨å–®ã€ç—…æ¯’ã€å ±å°ã€è¡¨é”ã€éƒ¨éšŠã€ç¬¨è›‹ã€èƒŒå°ã€æ³¢æ®µã€æš´å‹•ã€åŒ—æ–—ã€ç­†ç«¯ã€å†°é›•ã€å·´è±†ã€åŒ—æ–—' },
                    { q: 'ã„‡ ã„Œ', examples: 'é¦¬è·¯ã€ç¾éº—ã€é–€ç°¾ã€é­…åŠ›ã€é¢è‡¨ã€å‘½ä»¤ã€å¿™ç¢Œã€è‹—æ —ã€è¿·è·¯ã€éº»è¾£ã€ç‰¡è £ã€æ˜äº®ã€é­”åŠ›' },
                    { q: 'ã„‰ ã„Š', examples: 'é›»æ¢¯ã€é»é ­ã€åœ°åœ–ã€åœ°æ¯¯ã€å¤§é ­ã€å½ˆé ­ã€è›‹å¡”ã€è³­å¾’ã€åœ°éµã€å†¬å¤©ã€ç­”é¡Œã€å€’é€€ã€ç•¶å¤©ã€æ­¹å¾’ã€ç‡ˆå¡”ã€å€’å¡Œ' },
                    { q: 'ã„Š ã„Œ', examples: 'è¨è«–ã€é€ƒé›¢ã€è½åŠ›ã€æ¨ç†ã€é€éœ²ã€éµè·¯ã€å·æ‡¶ã€éµéŠã€æŠ•ç±ƒã€å½ˆåŠ›ã€é«”åŠ›ã€å¤©äº®ã€è·³æ¨“' },
                    { q: 'ã„‹ ã„•', examples: 'å¥³ç”Ÿã€ç”·ç”Ÿã€æººæ°´ã€å¥³ç¥ã€ç”·ç¥ã€å¿µæ›¸ã€æ‹¿æ‰‹ã€é›£å—ã€æš–èº«' },
                    { q: 'ã„‡ ã„ˆ', examples: 'é­”æ³•ã€å…è²»ã€éº»ç…©ã€æ¨¡ç¯„ã€æ¨¡ä»¿ã€èœœèœ‚ã€ç±³ç²‰ã€æ»¿åˆ†ã€éºµç²‰ã€ç¾é«®ã€å†’çŠ¯' },
                    { q: 'ã„‘ ã„—', examples: 'å¦»å­ã€èŒ„å­ã€è£™å­ã€ç¾¤çµ„ã€è¦ªè‡ªã€æ¶èµ°ã€ç°½å­—ã€æ¬ æã€å‹¸é˜»ã€å‰å¥' },
                    { q: 'ã„¨ ã„', examples: 'ç©å…·ã€æ–‡å…·ã€æ™šé–“ã€å¿˜è¨˜ã€å±æ©Ÿã€å¤–äº¤ã€å¤–ç•Œã€æˆ‘å®¶ã€æ–‡ä»¶ã€ç‰©åƒ¹ã€å¤–ç±ã€ç©å®¶ã€å•å·ã€èª¤è§£ã€å¿˜è¨˜' },
                    { q: 'ã„… ã„ˆ', examples: 'éƒ¨åˆ†ã€è¾¦æ³•ã€ä¸¦éã€çˆ†ç™¼ã€æ’­æ”¾ã€æ‹œè¨ªã€åŒ—æ–¹ã€ç—…æˆ¿ã€ç¹½ç´›ã€å ±å¾©ã€å‚™ä»½' },
                    { q: 'ã„ ã„’', examples: 'æ•™å­¸ã€ç°¡è¨Šã€é€²è¡Œã€èˆ‰è¡Œã€ç¹¼çºŒã€ç«¶é¸ã€æ±ºå¿ƒã€é©šå–œã€æ©Ÿæ¢°ã€å®¶é„‰ã€æ•™è¨“ã€æ¥µé™ã€æè¡€' },
                    { q: 'ã„• ã„…', examples: 'å¤±æ•—ã€é †ä¾¿ã€æ›¸åŒ…ã€æ›¸æœ¬ã€ä¸Šç­ã€è¨­å‚™ã€èº«é‚Šã€ç”Ÿç—…ã€å£«å…µã€æ‰‹è‡‚ã€æ‰‹éŒ¶ã€å®ˆå‚™ã€é–ƒé¿ã€å–„è®Šã€ç‡’é¤…ã€èº«é‚Š' },
                    { q: 'ã„… ã„Š', examples: 'æ¨™é¡Œã€åŠå¤©ã€ä¸åŒã€æ‹œè¨—ã€ç™½å¤©ã€è®Šæ…‹ã€æ“ºè„«ã€åŒ—æŠ•ã€å´©å¡Œã€å¸ƒæ¢' },
                    { q: 'ã„‰ ã„', examples: 'é›»è©±ã€å‹•ç•«ã€è›‹é»ƒã€å¤§æµ·ã€å¤§ç«ã€å°è©±ã€ç­‰å€™ã€å…Œæ›ã€å°èˆªã€å¾…æœƒã€ç‡ˆæœƒã€æ·¡åŒ–' },
                    { q: 'ã„‡ ã„•', examples: 'é¦¬ä¸Šã€æ²’äº‹ã€é­”è¡“ã€æ¨¡å¼ã€ç¾é£Ÿã€ç§˜æ›¸ã€é¢è©¦ã€é™Œç”Ÿã€è¬€æ®ºã€ç‰§å¸«ã€ç¾è¡“ã€è¿·å¤±' },
                    { q: 'ã„‰ ã„Œ', examples: 'å¤§åŠ›ã€å¤§é™¸ã€å¤§æ¨“ã€å¤§é‡ã€å¸¶ä¾†ã€ç¨ç«‹ã€é“è·¯ã€å…¸ç¦®ã€å¸¶é ˜ã€é“ç†ã€å‹•åŠ›ã€é›»åŠ›' },
                    { q: 'ã„… ã„Œ', examples: 'ç»ç’ƒã€æœ¬ä¾†ã€å‚é‡Œã€æ¯”ä¾‹ã€æš´åŠ›ã€å·´é»ã€éƒ¨è½ã€ä¿ç•™ã€è¾¯è«–ã€çˆ†æ–™' },
                    { q: 'ã„… ã„', examples: 'æ¯”è¼ƒã€ä¸è¦‹ã€ä¸åƒ…ã€åŒ—äº¬ã€ç•¢ç«Ÿã€èƒŒæ™¯ã€é ’çã€ç­æ©Ÿã€ä¸ä¹…ã€æ‚²åŠ‡ã€ç¶æ¶ã€ç·¨è¼¯ã€ç­†è¨˜' },
                    { q: 'ã„‰ ã„”', examples: 'é›»æ± ã€é›»è»Šã€åŠåºŠã€èª¿æŸ¥ã€é”æˆã€ç•¶åˆã€æ­ä¹˜ã€åˆ°è™•ã€å–®ç´”ã€ç•¶å ´ã€ç•¶æˆã€è³­å ´ã€å¤§è‡£ã€å–®è»Š' },
                    { q: 'ã„† ã„ˆ', examples: 'çš®è†šã€ä½©æœã€å¹³å‡¡ã€æ’æ”¾ã€é…æ–¹ã€è²§å¯Œã€æ¼‚æµ®ã€å‰–è…¹ã€ç¥¨æˆ¿ã€æ‰¹ç™¼ã€å±é¢¨' },
                    { q: 'ã„‰ ã„•', examples: 'é›»è¦–ã€è®€æ›¸ã€å¤§å¸«ã€ä½†æ˜¯ã€ç•¶æ™‚ã€å°æ‰‹ã€å¤šå°‘ã€éƒ½å¸‚ã€å¤§è²ã€å€’æ•¸ã€åœ°ä¸Šã€è‘£äº‹ã€å–®èº«' },
                    { q: 'ã„† ã„‰', examples: 'æ´¾å°ã€çš®å¸¶ã€å±æ±ã€é »é“ã€æ’éšŠã€é¾å¤§ã€åˆ¤æ–·ã€å¹³ç­‰ã€è·‘åˆ°ã€æ™®æ¸¡ã€å¹³åœ°' },
                    { q: 'ã„‡ ã„’', examples: 'é¢ç›¸ã€æ˜é¡¯ã€å¤¢æƒ³ã€æ˜æ˜Ÿã€æŸäº›ã€è²“ç†Šã€å†’éšªã€é‚å‘ã€æ¨¡å‹ã€éºµç·šã€è¿·ä¿¡' },
                    { q: 'ã„† ã„‰', examples: 'æ´¾å°ã€çš®å¸¶ã€å±æ±ã€é »é“ã€æ’éšŠã€é¾å¤§ã€åˆ¤æ–·ã€å¹³ç­‰ã€è·‘åˆ°ã€æ™®æ¸¡ã€å¹³åœ°' },
                    { q: 'ã„‰ ã„‡', examples: 'å¤§é–€ã€åœ°é¢ã€å°é¢ã€å‹•æ¼«ã€åº—é¢ã€ç¨»ç±³ã€é»åã€å€’æ¥£ã€å‹•è„ˆã€å¤§éº»' },
                    { q: 'ã„‡ ã„Š', examples: 'æ¯å¤©ã€æ˜å¤©ã€æ¯å¹´ã€æ˜å¹´ã€é¦¬æ¡¶ã€åª’é«”ã€é¦¬é ­ã€é¥…é ­ã€æœ¨é ­ã€ç…¤ç‚­ã€éºµæ¢ã€ç¾è…¿ã€æ¯›æ¯¯ã€é¦è…†ã€çœ‰é ­' },
                    { q: 'ã„¨ ã„', examples: 'ç„¡é—œã€å¤–åœ‹ã€æˆ‘åœ‹ã€å®Œå·¥ã€é•è¦ã€ç„¡è¾œã€ç¶²è³¼ã€å¤–è§€ã€çƒé¾œã€åœè§€ã€å¤–å…¬ã€æ­¦åŠŸã€å¤–æ›' },
                    { q: 'ã„‰ ã„‘', examples: 'æ‰“çƒã€åœ°çƒã€åº•å€ã€é“æ­‰ã€çš„ç¢ºã€çŸ­æœŸã€å®šæœŸã€é›»å™¨ã€çŸ­ç¼ºã€å¤§æ°£' },
                    { q: 'ã„… ã„†', examples: 'å¥”è·‘ã€é­ç‚®ã€èƒŒå›ã€è¢«é¨™ã€å¹«æ´¾ã€å¥”æ³¢ã€é€¼è¿«ã€çˆ†ç ´' },
                    { q: 'ã„¨ ã„‰', examples: 'èˆè¹ˆã€å‰å¤§ã€ç©©å®šã€å‘³é“ã€æº«åº¦ã€äº”é»ã€ç„¡æ•µã€å®Œè›‹ã€å±‹é ‚ã€å¿˜æ‰ã€èª¤å°ã€èåˆ°' },
                    { q: 'ã„‡ ã„', examples: 'è¿·å®®ã€ç¾åœ‹ã€æ°‘åœ‹ã€æ•æ„Ÿã€ç«ç‘°ã€èŠ’æœã€è’™å¤ã€é­”é¬¼ã€æœ¨ç“œã€è˜‘è‡' },
                    { q: 'ã„§ ã„©', examples: 'éŸ³æ¨‚ã€æ¸¸æ³³ã€é†«é™¢ã€æ†‚é¬±ã€è‹±èªã€æ¼”å“¡ã€çŒ¶è±«ã€é™é ã€è¨€èªã€ç”±æ–¼ã€é­·é­š' },
                    { q: 'ã„† ã„”', examples: 'ç“¢èŸ²ã€æ’é™¤ã€å¹³å¸¸ã€è³ å„Ÿã€ç ´ç”¢ã€å“å˜—ã€æ’æ–¥ã€è·‘è»Šã€æ§å ´ã€æ³¡èŒ¶' },
                    { q: 'ã„Š ã„“', examples: 'é«”é‡ã€é€šçŸ¥ã€å°ä¸­ã€æŒ‘æˆ°ã€èª¿æ•´ã€åœæ­¢ã€çµ±æ²»ã€å¤©çœŸã€åœ˜é•·ã€ç‰¹è³ªã€è²¼ç´™ã€ç‰¹å¾µã€é€”ä¸­ã€é«”è³ª' },
                    { q: 'ã„‰ ã„’', examples: 'æ“”å¿ƒã€æ±è¥¿ã€å¤§å°ã€å¤§å­¸ã€å°è±¡ã€é›»ä¿¡ã€ç•¶ä¸‹ã€åœ°ä¸‹ã€å¤§ç¬‘ã€é»å¿ƒã€å¤§è±¡' },
                    { q: 'ã„Š ã„ˆ', examples: 'é¢±é¢¨ã€é ­é«®ã€æ”¤è²©ã€æ¢è¨ªã€åœæ”¾ã€é€šé¢¨ã€é ¹å»¢ã€å¤©åˆ†ã€å ¤é˜²ã€é«”ç½°ã€å¤©è³¦' }
                ]
            }
        ];

        // ============================================================================
        // 3. Timer Component (è¨ˆæ™‚å™¨) - æ‰‹æ©Ÿç‰ˆå„ªåŒ–
        // ============================================================================
        const Timer = ({ initialTime, isRunning, setIsRunning, onTimeout, nextRoundFn }) => {
            const [totalSeconds, setTotalSeconds] = useState(initialTime);
            const [minInput, setMinInput] = useState("00");
            const [secInput, setSecInput] = useState("00");
            const [showTimeSetting, setShowTimeSetting] = useState(false);
            const [customMinutes, setCustomMinutes] = useState(Math.floor(initialTime / 60));
            const [customSeconds, setCustomSeconds] = useState(initialTime % 60);
            const { playCountdownBeep, playTimeUpBeep, playStartBeep, playPauseBeep, playResetBeep } = useBeep();
            const lastSecondsRef = useRef(totalSeconds);
            const initialTimeRef = useRef(initialTime);

            useEffect(() => {
                setTotalSeconds(initialTime);
                setIsRunning(false);
                lastSecondsRef.current = initialTime;
                initialTimeRef.current = initialTime;
                updateDisplay(initialTime);
                setCustomMinutes(Math.floor(initialTime / 60));
                setCustomSeconds(initialTime % 60);
            }, [initialTime, setIsRunning]);
            
            const updateDisplay = (seconds) => {
                const m = Math.floor(seconds / 60);
                const s = seconds % 60;
                setMinInput(String(m).padStart(2, '0'));
                setSecInput(String(s).padStart(2, '0'));
            };
            
            useEffect(() => {
                let interval = null;
                if (isRunning && totalSeconds > 0) {
                    playCountdownBeep(totalSeconds);
                    lastSecondsRef.current = totalSeconds;
                    interval = setInterval(() => {
                        setTotalSeconds(prev => {
                            const next = prev - 1;
                            updateDisplay(next);
                            if (next !== lastSecondsRef.current) {
                                playCountdownBeep(next);
                                lastSecondsRef.current = next;
                            }
                            if (next === 0) {
                                playTimeUpBeep();
                                setIsRunning(false);
                                if (onTimeout) onTimeout();
                            }
                            return next;
                        });
                    }, 1000);
                } else if (totalSeconds === 0 && isRunning) {
                    setIsRunning(false);
                }
                return () => { if (interval) clearInterval(interval); };
            }, [isRunning, totalSeconds, onTimeout, setIsRunning, playCountdownBeep, playTimeUpBeep]);

            const handlePlayPause = () => {
                const newIsRunning = !isRunning;
                setIsRunning(newIsRunning);
                if (newIsRunning) {
                    setShowTimeSetting(false);
                    playStartBeep();
                    playCountdownBeep(totalSeconds);
                } else {
                    playPauseBeep();
                }
            };
            
            const handleReset = () => {
                setIsRunning(false);
                setTotalSeconds(initialTimeRef.current);
                lastSecondsRef.current = initialTimeRef.current;
                updateDisplay(initialTimeRef.current);
                playResetBeep();
            };

            const handleSetTime = () => {
                if (isRunning) return;
                const newTotalSeconds = (customMinutes * 60) + customSeconds;
                if (newTotalSeconds > 0) {
                    setTotalSeconds(newTotalSeconds);
                    initialTimeRef.current = newTotalSeconds;
                    lastSecondsRef.current = newTotalSeconds;
                    updateDisplay(newTotalSeconds);
                    setShowTimeSetting(false);
                }
            };
            
            const isCritical = totalSeconds <= 10 && totalSeconds > 0 && isRunning;
            
            return (
                <div className="bg-white p-2 lg:p-4 rounded-xl lg:rounded-3xl shadow-lg border border-gray-200 flex flex-row lg:flex-col items-center justify-between lg:justify-center w-full gap-2 lg:gap-0">
                    
                    {/* PCç‰ˆæ¨™é¡Œ (æ‰‹æ©Ÿç‰ˆéš±è—) */}
                    <div className="hidden lg:flex justify-center items-center mb-2 w-full text-gray-500 font-bold text-base">
                         <ClockIcon className="w-4 h-4 mr-1" stroke="gray" /> è¨ˆæ™‚å™¨
                    </div>

                    {/* æ™‚é–“é¡¯ç¤º */}
                    <div className={`flex items-center justify-center bg-gray-800 rounded-lg lg:rounded-2xl p-1 lg:p-2 lg:mb-4 transition-colors duration-300 w-auto lg:w-full lg:max-w-[200px] flex-shrink-0 ${isCritical ? 'bg-red-600 animate-pulse' : ''}`}>
                         <div className="w-8 lg:w-16 bg-transparent text-white text-2xl lg:text-5xl font-mono font-black text-center">
                            {minInput}
                         </div>
                         <span className="text-white text-xl lg:text-4xl font-black pb-0.5 lg:pb-2">:</span>
                         <div className="w-8 lg:w-16 bg-transparent text-white text-2xl lg:text-5xl font-mono font-black text-center">
                            {secInput}
                         </div>
                    </div>

                    {/* æ§åˆ¶æŒ‰éˆ•ç¾¤ (æ‰‹æ©Ÿç‰ˆæ°´å¹³æ’åˆ—) */}
                    <div className="flex flex-row gap-2 items-center flex-1 justify-end lg:justify-center lg:w-full">
                         {/* é–‹å§‹/æš«åœ */}
                        <button 
                            onClick={handlePlayPause} 
                            className={`px-3 py-2 lg:py-3 rounded-lg lg:rounded-xl font-bold text-sm lg:text-lg shadow-sm border-b-2 lg:border-b-4 active:scale-95 transition-all flex items-center justify-center flex-1 lg:flex-none lg:w-full ${
                                isRunning ? 'bg-yellow-400 border-yellow-600 text-yellow-900' : 'bg-green-500 border-green-700 text-white'
                            }`}
                        >
                           <span className="lg:hidden">{isRunning ? 'æš«åœ' : 'é–‹å§‹'}</span>
                           <span className="hidden lg:inline">{isRunning ? 'æš«åœ' : 'é–‹å§‹'}</span>
                        </button>
                        
                        {/* é‡ç½® */}
                        <button 
                            onClick={handleReset} 
                            className="px-2 lg:px-4 py-2 lg:py-3 bg-gray-200 border-b-2 lg:border-b-4 border-gray-400 text-gray-700 font-bold rounded-lg lg:rounded-xl shadow-sm active:scale-95 flex items-center justify-center"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-5 h-5 lg:w-6 lg:h-6">
                                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                                <path d="M3 3v5h5"/>
                            </svg>
                        </button>

                         {/* è¨­å®šæ™‚é–“ (æ‰‹æ©Ÿç‰ˆç‚ºåœ–ç¤º) */}
                        <button 
                            onClick={() => setShowTimeSetting(!showTimeSetting)}
                            disabled={isRunning}
                            className="px-2 lg:w-full py-2 lg:py-2 bg-blue-100 text-blue-700 font-bold rounded-lg lg:rounded-xl border lg:border border-blue-200 hover:bg-blue-200 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm lg:text-base lg:mt-3 flex items-center justify-center border-b-2 lg:border-b-0 border-blue-300 lg:border-transparent"
                        >
                           <span className="lg:hidden"><SettingsIcon className="w-5 h-5"/></span>
                           <span className="hidden lg:inline">è¨­å®šæ™‚é–“</span>
                        </button>

                        {/* ä¸‹ä¸€é¡Œ (æ‰‹æ©Ÿç‰ˆæ•´åˆåœ¨æ­¤) */}
                        <button onClick={nextRoundFn} className="lg:hidden px-3 py-2 bg-gray-800 text-white font-black text-sm rounded-lg shadow-lg border-b-2 border-gray-900 hover:bg-gray-700 active:scale-95 transition-all flex items-center justify-center whitespace-nowrap">
                             ä¸‹ä¸€é¡Œ
                        </button>
                    </div>

                    {/* æ™‚é–“è¨­å®šé¢æ¿ */}
                    {showTimeSetting && (
                        <div className="absolute bottom-full mb-2 lg:static lg:mb-0 left-0 right-0 z-50 mt-2 w-full p-3 lg:p-4 bg-gray-50 rounded-xl border border-gray-200 animate-bounce-in shadow-xl lg:shadow-none">
                            <div className="text-sm font-bold text-gray-600 mb-2 lg:mb-3 text-center">è¨­å®šæ™‚é–“</div>
                            <div className="flex items-center justify-center gap-2 lg:gap-3 mb-3 lg:mb-4">
                                <div className="flex items-center bg-white rounded-lg border border-gray-300 p-1 lg:p-2">
                                    <input type="number" min="0" max="99" value={customMinutes} onChange={(e) => setCustomMinutes(parseInt(e.target.value) || 0)} disabled={isRunning} className="w-10 lg:w-12 text-center bg-transparent outline-none font-mono font-bold text-gray-700 text-base lg:text-lg" />
                                    <span className="text-gray-500 font-bold mx-1 lg:mx-2 text-sm lg:text-base">åˆ†</span>
                                </div>
                                <div className="flex items-center bg-white rounded-lg border border-gray-300 p-1 lg:p-2">
                                    <input type="number" min="0" max="59" value={customSeconds} onChange={(e) => setCustomSeconds(parseInt(e.target.value) || 0)} disabled={isRunning} className="w-10 lg:w-12 text-center bg-transparent outline-none font-mono font-bold text-gray-700 text-base lg:text-lg" />
                                    <span className="text-gray-500 font-bold mx-1 lg:mx-2 text-sm lg:text-base">ç§’</span>
                                </div>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={handleSetTime} disabled={isRunning} className="flex-1 py-2 bg-green-500 text-white font-bold rounded-lg border border-green-600 hover:bg-green-600 disabled:opacity-50 text-sm lg:text-base">ç¢ºèª</button>
                                <button onClick={() => setShowTimeSetting(false)} className="flex-1 py-2 bg-gray-300 text-gray-700 font-bold rounded-lg border border-gray-400 hover:bg-gray-400 text-sm lg:text-base">å–æ¶ˆ</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // ============================================================================
        // 4. FlipGrid Component (Game 1)
        // ============================================================================
        const FlipGrid = ({ roundData }) => {
            const [flippedIndices, setFlippedIndices] = useState(new Set());
            const [isAnimating, setIsAnimating] = useState(false);

            useEffect(() => { setFlippedIndices(new Set()); }, [roundData]);

            const flipRandomCard = () => {
                if (isAnimating) return;
                const totalCards = roundData.content.length;
                const availableIndices = [];
                for (let i = 0; i < totalCards; i++) {
                    if (!flippedIndices.has(i)) availableIndices.push(i);
                }
                if (availableIndices.length === 0) {
                    const messageBox = document.getElementById('message-box');
                    if (messageBox) {
                        messageBox.innerHTML = '<div class="text-center"><h3 class="text-xl font-bold text-white mb-2">æç¤º</h3><p>æœ¬å›åˆé¡Œç›®å·²å…¨æ•¸ç¿»é–‹ï¼</p></div>';
                        messageBox.style.display = 'flex';
                        messageBox.className = 'fixed bottom-1/2 left-1/2 -translate-x-1/2 translate-y-1/2 bg-yellow-500 text-white p-6 rounded-xl shadow-2xl z-[99] flex items-center justify-center animate-bounce-in w-10/12 max-w-sm';
                        setTimeout(() => messageBox.style.display = 'none', 3000);
                    }
                    return;
                }
                setIsAnimating(true);
                const randomIndex = availableIndices[Math.floor(Math.random() * availableIndices.length)];
                setFlippedIndices(prev => new Set(prev).add(randomIndex));
                setTimeout(() => setIsAnimating(false), 600);
            };

            return (
                <div className="flex flex-col h-full">
                    <div className="mb-2 lg:mb-4 flex justify-between items-center bg-white p-2 lg:p-3 rounded-xl lg:rounded-2xl shadow-sm border border-gray-100 flex-shrink-0">
                        <div className="px-2">
                            <span className="text-xs font-bold text-gray-400 uppercase block">ä¸»é¡Œ</span>
                            <h2 className="text-lg lg:text-2xl font-black text-blue-800 truncate max-w-[150px] lg:max-w-none">{roundData.category}</h2>
                        </div>
                        <button
                            onClick={flipRandomCard}
                            disabled={flippedIndices.size === roundData.content.length || isAnimating}
                            className="px-4 py-2 lg:px-6 lg:py-3 bg-orange-500 text-white text-sm lg:text-lg font-bold rounded-lg lg:rounded-xl shadow-lg hover:bg-orange-600 active:scale-95 disabled:opacity-50 transition-all border-b-2 lg:border-b-4 border-orange-700 flex items-center whitespace-nowrap"
                        >
                            <ZapIcon className="w-4 h-4 lg:w-5 lg:h-5 mr-1 lg:mr-2" stroke="white"/>
                            å‡ºé¡Œ
                        </button>
                    </div>

                    <div className="flex-1 grid grid-cols-4 lg:grid-cols-6 gap-2 lg:gap-3 p-2 lg:p-4 bg-blue-50/50 rounded-2xl lg:rounded-3xl border-2 lg:border-4 border-dashed border-blue-200 overflow-y-auto">
                        {roundData.content.map((char, idx) => {
                            const isFlipped = flippedIndices.has(idx);
                            return (
                                <div key={idx} className="relative w-full aspect-square perspective-1000">
                                    <div className={`relative w-full h-full transition-transform duration-500 transform-style-3d`} style={{ transformStyle: 'preserve-3d', transform: isFlipped ? 'rotateY(180deg)' : 'rotateY(0deg)' }}>
                                        <div className="absolute w-full h-full backface-hidden bg-white rounded-lg lg:rounded-2xl shadow-sm lg:shadow-xl border-b-2 lg:border-b-4 border-blue-400 flex items-center justify-center select-none">
                                            <span className="text-lg lg:text-3xl font-bold text-gray-400">?</span>
                                        </div>
                                        <div className="absolute w-full h-full backface-hidden rotate-y-180 bg-yellow-300 rounded-lg lg:rounded-2xl shadow-sm lg:shadow-xl border-b-2 lg:border-b-4 border-yellow-500 flex items-center justify-center select-none">
                                            <span className="text-4xl sm:text-5xl lg:text-[5rem] font-black text-yellow-900">{char}</span>
                                        </div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        // ============================================================================
        // 5. FlashCardBoard Component (Game 2 & 3)
        // ============================================================================
        const FlashCardBoard = ({ roundData, type }) => {
            const [showAnswer, setShowAnswer] = useState(false);
            const [showHint, setShowHint] = useState(false);
            const [showExample, setShowExample] = useState(false);

            useEffect(() => {
                setShowAnswer(false);
                setShowHint(false);
                setShowExample(false);
            }, [roundData]);

            const isGame2 = type === 'game2';
            const isGame3 = type === 'game3';

            return (
                <div className="relative flex flex-col h-full items-center justify-center p-4 lg:p-8 bg-white/60 rounded-[1.5rem] lg:rounded-[3rem] border-4 lg:border-8 border-white shadow-xl min-h-[300px]">
                    <div className="absolute top-2 right-2 lg:top-6 lg:right-6 flex gap-2 z-20">
                        {isGame2 && (
                            <button onClick={() => setShowHint(true)} disabled={showAnswer} className="px-3 py-2 lg:px-5 lg:py-3 bg-yellow-400 hover:bg-yellow-500 text-yellow-900 font-bold rounded-xl lg:rounded-2xl shadow-md transition-all flex items-center border-b-2 lg:border-b-4 border-yellow-600 active:scale-95 disabled:opacity-50 text-xs lg:text-base">
                                <LightbulbIcon className="w-4 h-4 lg:w-5 lg:h-5 mr-1 lg:mr-2" stroke="currentColor"/> æç¤º
                            </button>
                        )}
                        {isGame3 && (
                            <button onClick={() => setShowExample(!showExample)} className="px-3 py-2 lg:px-5 lg:py-3 bg-purple-500 hover:bg-purple-600 text-white font-bold rounded-xl lg:rounded-2xl shadow-md transition-all flex items-center border-b-2 lg:border-b-4 border-purple-700 active:scale-95 text-xs lg:text-base">
                                <BookOpenIcon className="w-4 h-4 lg:w-5 lg:h-5 mr-1 lg:mr-2" stroke="white"/> åƒè€ƒ
                            </button>
                        )}
                    </div>

                    {isGame3 && showExample && (
                        <div className="absolute inset-0 bg-white/95 backdrop-blur-sm z-30 rounded-[1.5rem] lg:rounded-[2.5rem] flex flex-col items-center justify-center p-6 lg:p-12 animate-bounce-in">
                            <h4 className="text-xl lg:text-2xl text-purple-600 font-bold mb-4 flex items-center">
                                <BookOpenIcon className="w-5 h-5 lg:w-6 lg:h-6 mr-2" stroke="currentColor"/> åƒè€ƒç­”æ¡ˆ
                            </h4>
                            <p className="text-xl lg:text-4xl font-black text-gray-800 leading-relaxed text-center">
                                {roundData.examples || "(è«‹è€å¸«å¡«å¯«ç­”æ¡ˆç¯„ä¾‹)"}
                            </p>
                            <button onClick={() => setShowExample(false)} className="mt-8 px-6 py-2 lg:px-8 lg:py-3 bg-gray-200 hover:bg-gray-300 text-gray-600 font-bold rounded-full shadow-md active:scale-95 text-sm lg:text-base">é—œé–‰</button>
                        </div>
                    )}

                    <div className="text-center w-full mb-6 lg:mb-12 mt-8 lg:mt-0">
                        {isGame2 && (
                            <p className={`font-bold mb-2 lg:mb-4 tracking-widest uppercase transition-all duration-300 h-8 flex items-center justify-center ${showHint ? 'text-lg lg:text-2xl text-yellow-600 bg-yellow-100 py-1 px-4 lg:py-2 lg:px-6 rounded-full inline-block' : 'text-gray-400 text-sm lg:text-base'}`}>
                                {showHint ? `ğŸ’¡ æç¤ºï¼š${roundData.hint || 'ç„¡æç¤º'}` : 'è«‹çŒœè©èª'}
                            </p>
                        )}

                        {isGame3 && <p className="text-gray-400 font-bold mb-4 tracking-widest uppercase text-sm lg:text-base">è«‹æ¥é¾é€ è©</p>}

                        <div className={`font-black text-blue-600 drop-shadow-sm tracking-widest transition-all duration-300 ${isGame2 ? 'text-6xl lg:text-[6rem]' : 'text-7xl lg:text-[8rem]'}`}>
                            {roundData.q}
                        </div>
                    </div>

                    {isGame2 ? (
                        <div className="mt-auto flex flex-col items-center w-full">
                            <div className={`transition-all duration-300 ${showAnswer ? 'max-h-24 opacity-100' : 'max-h-0 opacity-0 overflow-hidden'}`}>
                                <h3 className="text-2xl lg:text-4xl font-black text-red-600 bg-red-100 border-2 border-red-300 px-6 py-3 lg:px-8 lg:py-4 rounded-xl shadow-inner inline-block tracking-wider">
                                    {roundData.a}
                                </h3>
                            </div>
                            
                            <button onClick={() => setShowAnswer(!showAnswer)} className={`mt-4 lg:mt-6 px-6 py-3 lg:px-8 lg:py-4 text-lg lg:text-xl font-black rounded-3xl shadow-lg hover:shadow-xl transition-all border-b-4 active:scale-95 ${showAnswer ? 'bg-gray-300 text-gray-700 border-gray-500' : 'bg-red-500 text-white border-red-700'}`}>
                                {showAnswer ? 'éš±è—ç­”æ¡ˆ' : 'é¡¯ç¤ºç­”æ¡ˆ'}
                            </button>
                        </div>
                    ) : (
                        <div className="text-center mt-4">
                            <p className="text-xl lg:text-3xl font-black text-red-500 animate-pulse flex items-center justify-center">
                                <ZapIcon className="w-6 h-6 lg:w-8 lg:h-8 mr-2" stroke="red" fill="red"/> è«‹æ¶ç­”
                            </p>
                        </div>
                    )}
                </div>
            );
        };
        
        // ============================================================================
        // 6. TimeUpModal (æ™‚é–“åˆ°å½ˆçª—)
        // ============================================================================
        const TimeUpModal = ({ onClose }) => (
            <div className="fixed inset-0 bg-red-900/40 backdrop-blur-sm z-[100] flex items-center justify-center p-4">
                <div className="bg-white rounded-[2rem] lg:rounded-[3rem] shadow-2xl p-6 lg:p-10 w-full max-w-sm animate-bounce-in relative border-b-8 border-red-500">
                    <div className="text-center">
                        <div className="text-red-500 mb-4 animate-ping-once">
                            <ClockIcon className="mx-auto w-16 h-16 lg:w-20 lg:h-20" />
                        </div>
                        <h3 className="text-4xl lg:text-5xl font-black text-red-700 mb-4 leading-tight">æ™‚é–“åˆ°ï¼</h3>
                        <p className="text-base lg:text-lg text-gray-600 font-bold">è«‹ç«‹å³åœæ­¢ä½œç­”ã€‚</p>
                    </div>
                    <div className="mt-8 text-center">
                        <button onClick={onClose} className="w-full px-8 py-3 text-lg lg:text-xl font-bold rounded-2xl shadow-lg transition-all border-b-4 bg-red-600 text-white border-red-800 hover:bg-red-700 active:scale-95">
                            ç¢ºèª
                        </button>
                    </div>
                </div>
            </div>
        );

        // ============================================================================
        // 7. App Main (ä¸»æ‡‰ç”¨ç¨‹å¼)
        // ============================================================================
        const RuleModal = ({ game, onClose }) => (
            <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                <div className="bg-white rounded-[2rem] lg:rounded-[3rem] shadow-2xl p-6 lg:p-10 w-full max-w-2xl animate-bounce-in relative max-h-[90vh] overflow-y-auto">
                    <button onClick={onClose} className="absolute top-4 right-4 lg:top-6 lg:right-6 p-2 lg:p-3 text-gray-400 hover:text-gray-600 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                    <div className="text-center mb-4 lg:mb-6 mt-4 lg:mt-0">
                        <h3 className={`text-3xl lg:text-4xl font-black ${game.textColor} mb-2`}>{game.title}</h3>
                        <p className="text-lg lg:text-xl text-gray-500 font-bold">{game.subtitle}</p>
                    </div>
                    <div className="whitespace-pre-wrap text-base lg:text-lg text-gray-700 p-4 lg:p-6 bg-gray-50 rounded-2xl border border-gray-200 shadow-inner">
                        {game.rule}
                    </div>
                    <div className="mt-6 lg:mt-8 text-center">
                        <button onClick={onClose} className={`px-6 py-3 lg:px-8 lg:py-3 text-lg lg:text-xl font-bold rounded-full shadow-lg transition-all border-b-4 ${game.color} text-white border-b-4 border-gray-700 active:scale-95`}>
                            é–‹å§‹éŠæˆ²
                        </button>
                    </div>
                </div>
            </div>
        );
        
        const App = () => {
            const [activeGameId, setActiveGameId] = useState(null);
            const [showRuleModal, setShowRuleModal] = useState(false);
            const [viewedRules, setViewedRules] = useState([]);
            const [currentRoundIdx, setCurrentRoundIdx] = useState(0);
            const [timerRunning, setTimerRunning] = useState(false);
            const [showTimeUpModal, setShowTimeUpModal] = useState(false);

            const activeGameConfig = GAMES_CONFIG.find(g => g.id === activeGameId);
            const currentRound = activeGameConfig?.rounds[currentRoundIdx];

            const handleSelectGame = (gameId) => {
                setActiveGameId(gameId);
                setCurrentRoundIdx(0);
                setTimerRunning(false);
                setShowTimeUpModal(false);
                if (!viewedRules.includes(gameId)) {
                    setShowRuleModal(true);
                    setViewedRules(prev => [...prev, gameId]);
                }
            };

            const nextRound = () => {
                const messageBox = document.getElementById('message-box');
                const totalRounds = activeGameConfig.rounds.length;
                setShowTimeUpModal(false);

                if (currentRoundIdx < totalRounds - 1) {
                    setCurrentRoundIdx(prev => prev + 1);
                    setTimerRunning(false);
                } else {
                    if (messageBox) {
                        messageBox.innerHTML = '<div class="text-center"><h3 class="text-xl font-black text-white mb-2">æ­å–œï¼ğŸ‰</h3><p>æœ¬å–®å…ƒé¡Œç›®å·²å…¨éƒ¨çµæŸï¼</p></div>';
                        messageBox.style.display = 'flex';
                        messageBox.className = 'fixed bottom-1/2 left-1/2 -translate-x-1/2 translate-y-1/2 bg-blue-600 text-white p-6 rounded-xl shadow-2xl z-[99] flex items-center justify-center animate-bounce-in w-10/12 max-w-sm';
                        setTimeout(() => messageBox.style.display = 'none', 4000);
                    }
                    setCurrentRoundIdx(0);
                    setTimerRunning(false);
                }
            };

            const HeaderBar = ({ activeGameConfig, currentRoundIdx, setActiveGameId, setShowRuleModal }) => {
                const GameIcon = activeGameConfig.IconComponent;
                const totalRounds = activeGameConfig.rounds.length;

                return (
                    <div className={`p-3 lg:p-6 flex flex-row justify-between items-center ${activeGameConfig.color} bg-opacity-20 border-b-2 lg:border-b-4 ${activeGameConfig.borderColor}`}>
                        <div className="flex items-center w-full">
                            <button onClick={() => setActiveGameId(null)} className={`flex-shrink-0 flex items-center text-sm lg:text-base font-black px-2 lg:px-3 py-1 lg:py-2 rounded-lg lg:rounded-xl transition-all border-2 border-transparent ${activeGameConfig.textColor} hover:bg-white/80 shadow-sm lg:shadow-md`}>
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="mr-1"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><path d="M9 22V12h6v10"/></svg> é¦–é 
                            </button>
                            <div className="h-6 lg:h-8 w-px mx-2 lg:mx-6 bg-gray-400/50"></div>
                            <GameIcon className={`w-6 h-6 lg:w-10 lg:h-10 ${activeGameConfig.textColor} mr-2 lg:mr-3 flex-shrink-0`} stroke="currentColor" size={40}/>
                            <div className="min-w-0">
                                <h2 className={`text-lg lg:text-3xl font-black ${activeGameConfig.textColor} leading-tight truncate`}>{activeGameConfig.title}</h2>
                                <span className="text-xs lg:text-sm font-bold bg-white/60 px-2 py-0.5 rounded-md text-gray-600 mt-1 inline-block border border-gray-300">
                                    å›åˆ {currentRoundIdx + 1} / {totalRounds}
                                </span>
                            </div>
                        </div>
                        <button onClick={() => setShowRuleModal(true)} className={`hidden lg:block p-3 bg-white rounded-full text-gray-500 hover:text-white transition-colors shadow-lg font-black ${activeGameConfig.color} hover:bg-opacity-80`}>
                            <BookOpenIcon className="w-6 h-6" stroke="currentColor" />
                        </button>
                    </div>
                );
            };

            if (!activeGameId) {
                return (
                    <div className="min-h-screen bg-blue-50 font-sans p-4 lg:p-8 flex items-center justify-center overflow-y-auto" style={{ backgroundColor: '#F0F9FF' }}>
                        <div className="max-w-6xl w-full flex flex-col items-center">
                            <div className="text-center space-y-2 lg:space-y-4 mb-8 lg:mb-16 mt-8 lg:mt-0">
                                <h1 className="text-5xl lg:text-[5rem] font-black text-blue-900 tracking-tight leading-none drop-shadow-md">
                                    æ³¨éŸ³å¥½å¥½ç©<span className="text-blue-500 block lg:inline">ã„…ã„†ã„‡</span>
                                </h1>
                                <p className="text-lg lg:text-2xl text-blue-600/60 font-bold tracking-widest">æº–å‚™å¥½é–‹å§‹äº†å—?</p>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6 lg:gap-8 w-full">
                                {GAMES_CONFIG.map((game) => {
                                    const Icon = game.IconComponent;
                                    return (
                                        <button key={game.id} onClick={() => handleSelectGame(game.id)} className="flex flex-col items-center p-6 lg:p-8 bg-white rounded-[2rem] lg:rounded-[2.5rem] shadow-xl border-b-[8px] lg:border-b-[12px] border-gray-100 hover:scale-105 hover:shadow-2xl transition-all group h-64 lg:h-80 justify-center relative overflow-hidden">
                                            <div className="absolute inset-0 opacity-5 pointer-events-none" style={{backgroundImage: 'radial-gradient(#000 1px, transparent 1px)', backgroundSize: '30px 30px'}}></div>
                                            <Icon className={`w-16 h-16 lg:w-20 lg:h-20 ${game.textColor} mb-3 lg:mb-4 group-hover:scale-110 transition-transform`} stroke="currentColor" size={80}/>
                                            <h2 className={`text-2xl lg:text-4xl font-black ${game.textColor} drop-shadow-sm`}>{game.title}</h2>
                                            <p className="text-gray-500 font-bold mt-1 text-base lg:text-lg">{game.subtitle}</p>
                                            <div className={`absolute bottom-0 left-0 w-full h-2 ${game.color} opacity-70`}></div>
                                        </button>
                                    );
                                })}
                            </div>

                            <footer className="mt-12 lg:mt-16 text-gray-400 text-xs lg:text-sm">éŠæˆ²è¨­è¨ˆ by æ–‡ç‘œ</footer>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen h-screen flex flex-col bg-blue-50/50 backdrop-blur-sm relative overflow-hidden">
                    {showRuleModal && <RuleModal game={activeGameConfig} onClose={() => setShowRuleModal(false)} />}
                    {showTimeUpModal && <TimeUpModal onClose={() => setShowTimeUpModal(false)} />}

                    <div className="flex-1 flex flex-col max-w-[90rem] mx-auto w-full h-full bg-white/90 backdrop-blur-xl shadow-2xl overflow-hidden">
                        <HeaderBar activeGameConfig={activeGameConfig} currentRoundIdx={currentRoundIdx} setActiveGameId={setActiveGameId} setShowRuleModal={setShowRuleModal} />

                        {/* RWD ä½ˆå±€: æ‰‹æ©Ÿç‰ˆ flex-col (éŠæˆ²åœ¨ä¸Šæ–¹, è¨ˆæ™‚å™¨åœ¨æ¥µä¸‹æ–¹), é›»è…¦ç‰ˆ flex-row (å·¦å³å´) */}
                        <div className="flex-1 flex flex-col lg:flex-row p-2 lg:p-6 lg:pt-0 gap-2 lg:gap-4 overflow-hidden"> 
                            
                            {/* 1. éŠæˆ²å…§å®¹å€å¡Š (ä½”æ“šçµ•å¤§éƒ¨åˆ†ç©ºé–“) */}
                            <div className="flex-1 bg-white rounded-xl lg:rounded-[2.5rem] border-2 lg:border-4 border-white shadow-sm p-2 lg:p-4 overflow-hidden relative order-1 lg:order-2 flex flex-col">
                                <div className="absolute inset-0 opacity-5 pointer-events-none" style={{backgroundImage: 'radial-gradient(#000 1px, transparent 1px)', backgroundSize: '20px 20px'}}></div>
                                {activeGameConfig.id === 'game1' ? (
                                    <FlipGrid roundData={currentRound} />
                                ) : (
                                    <FlashCardBoard roundData={currentRound} type={activeGameConfig.id} />
                                )}
                            </div>

                            {/* 2. æ§åˆ¶æ¬„ (Timer + Next Button) - æ‰‹æ©Ÿç‰ˆæ©«å‘æ¥µç°¡åŒ–åœ¨åº•éƒ¨ */}
                            <div className="w-full lg:w-[22rem] flex flex-col gap-2 lg:gap-4 lg:py-4 order-2 lg:order-1 flex-shrink-0">
                                {/* Timer çµ„ä»¶ç¾åœ¨åŒ…å«æ‰€æœ‰æ§åˆ¶é …ï¼ˆåœ¨æ‰‹æ©Ÿç‰ˆï¼‰ */}
                                <Timer 
                                    initialTime={activeGameConfig.defaultTime} 
                                    isRunning={timerRunning} 
                                    setIsRunning={setTimerRunning} 
                                    onTimeout={() => setShowTimeUpModal(true)} 
                                    nextRoundFn={nextRound}
                                />
                                {/* é›»è…¦ç‰ˆç¨ç«‹çš„ä¸‹ä¸€é¡ŒæŒ‰éˆ• (æ‰‹æ©Ÿç‰ˆå·²æ•´åˆé€² Timer) */}
                                <button onClick={nextRound} className="hidden lg:flex w-full py-3 lg:py-5 bg-gray-800 text-white font-black text-lg lg:text-xl rounded-2xl lg:rounded-3xl shadow-lg border-b-4 border-gray-900 hover:bg-gray-700 active:scale-95 transition-all items-center justify-center">
                                    ä¸‹ä¸€é¡Œ <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-5 h-5 ml-2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                                </button>
                            </div>
                        </div>
                        
                        <div id="message-box" className="fixed bottom-1/2 left-1/2 -translate-x-1/2 translate-y-1/2 hidden transition-all duration-300"></div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

